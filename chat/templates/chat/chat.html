{% extends 'base.html' %} {% block body %}
<style>
  .line_separator {
    border-top: 2px solid #0D47A1;
  }
</style>

<div class="p-6 w-full">
  <h1 class="text-3xl tracking-tight font-light" id="chat-header"></h1>
  <div
    class="mt-4 w-full relative p-6 overflow-y-auto h-[30rem] bg-gray-50 border border-gray-200"
    id="chat-box">
    <ul class="space-y-2" id="chat-log">
    </ul>
  </div>
  <div class="mt-4 in-line flex">
    <input
      id="chat-message-input"
      class="w-full py-2 outline-none bg-gray-50 border border-gray-300 text-gray-900 text-sm focus:border-blue-500"
      type="text"
      placeholder="Write your message here."
    />
    <button
      id="chat-message-submit"
      class="py-2 px-4 ml-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-800 hover:bg-blue-900"
      type="submit"
    >
      Send
    </button>
  </div>
</div>

{% endblock %} {% block scripts%}
<script>
  var wss_protocol = window.location.protocol == "https:" ? "wss://" : "ws://";
  var chatSocket = new WebSocket(
    wss_protocol + window.location.host + "/ws/chat/"
  );
  var messages = [];

    function create_message_container (msg){
        if (msg.source == 'bot'){
            var start_end_val = 'justify-start'
            var color = 'text-gray-700 bg-white border border-gray-200'
        } else if (msg.source == 'user') {
            var start_end_val = 'justify-end'
            var color = "bg-blue-600 text-white"
        }

        const container = 
            `<li class="flex ${start_end_val}"> 
            <div class="relative max-w-xl px-4 py-2 rounded-lg shadow-md ${color}">
            <span className="block font-normal">${msg.msg}</span>
            <div class="line_separator">
            <span className="block font-normal">${msg.msg}</span>
</div>
            </div></li>`

        return container
    }

  chatSocket.onopen = function (e) {
    document.querySelector("#chat-header").innerHTML =
      "Welcome to Django Chatbot";

    var message = {'msg' : "Hi! I'm Fin, your fluent friend. Speak to me in any language and lets have a conversation.", 'source' : 'bot'}
    document.querySelector("#chat-log").innerHTML += create_message_container(message);
  };

  chatSocket.onmessage = function (e) {
    var data = JSON.parse(e.data);
    var message = data["text"];

    document.querySelector("#chat-log").innerHTML += create_message_container(message);
  };

  chatSocket.onclose = function (e) {
    //alert("Socket closed unexpectedly, please reload the page.");
  };

  document.querySelector("#chat-message-input").focus();
  document.querySelector("#chat-message-input").onkeyup = function (e) {
    if (e.keyCode === 13) {
      // enter, return
      document.querySelector("#chat-message-submit").click();
    }
  };

  document.querySelector("#chat-message-submit").onclick = function (e) {
    var messageInputDom = document.querySelector("#chat-message-input");
    var message = messageInputDom.value;
    chatSocket.send(
      JSON.stringify({
        text: message,
      })
    );

    messageInputDom.value = "";
  };
</script>
{% endblock %}
